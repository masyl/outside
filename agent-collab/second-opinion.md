# PLAN GENERATED BY GLM 4.7

## Implementation Plan: Timeline UI Components

Based on the pitch analysis and your preferences, here's the detailed implementation plan:

### Summary

Create a PIXI-based **TimelineBar** component that displays a visual indicator for current timeline position. Most DebugOverlay functionality is already complete; this deliverable primarily focuses on the visual timeline bar.

### User Decisions

- **Dimensions**: 24px thick, 8px padding
- **Position Style**: Marker only (thin vertical line)
- **Positioning**: 50px from bottom
- **Step Limit**: No visualization (keep simple)

---

### Tasks

#### 1. Create TimelineBar Component

**File**: `packages/outside-client/src/ui/timelineBar.ts` (new)

**Implementation Details**:

- Extend PIXI `Container` class
- Constructor takes `app: Application` and `timelineManager: TimelineManager`
- **Black padding rectangle**: 8px padding on all sides, full screen width
- **Green bar**: 24px height, centered within padding
- **Position marker**: Thin vertical line (2px width) showing current step
- **Methods**:
  - `updatePosition(currentStep: number, totalSteps: number)` - Update marker position
  - `setVisible(visible: boolean)` - Toggle visibility
  - `onResize()` - Handle window resize
  - `dispose()` - Cleanup

**Color Scheme**:

- Black padding: `0x000000` with alpha `1.0` (opaque)
- Green bar: `0x00ff00` (matching DebugOverlay)
- Position marker: `0x000000` (black) or `0xffffff` (white) for contrast

---

#### 2. Integrate TimelineBar into main.ts

**File**: `packages/outside-client/src/main.ts`

**Changes**:

- Import `TimelineBar` class
- In `initializeHostMode()` (after line 448), create TimelineBar instance:
  ```typescript
  const timelineBar = new TimelineBar(app, timelineManager);
  ```
- Add to PIXI stage: `app.stage.addChild(timelineBar.container)`
- Subscribe to TimelineManager position changes to update the bar
- Handle window resize: call `timelineBar.onResize()` in resize event listener

**Note**: TimelineBar should only be created in host mode (not client mode), per pitch requirements.

---

#### 3. Update TimelineManager Position Notifications

**File**: `packages/outside-client/src/timeline/manager.ts`

**Enhancement**:

- The `notifyPositionChange()` method (line 59) already exists but needs improvement
- Currently only checks for `onPositionChange` callback on state change callbacks
- Consider adding a dedicated position change callback system:

  ```typescript
  private positionChangeCallbacks: ((step: number, total: number) => void)[] = [];

  onPositionChange(callback: (step: number, total: number) => void): void {
    this.positionChangeCallbacks.push(callback);
  }

  private notifyPositionChange(): void {
    const events = this.eventLogger.loadEvents();
    this.positionChangeCallbacks.forEach(callback => {
      callback(this.pointer, events.length);
    });
  }
  ```

---

#### 4. DebugOverlay Enhancements (Verify Implementation)

**File**: `packages/outside-client/src/debug/overlay.ts`

**Status**: ✅ Already Implemented

- `setPlaybackMode()` - line 220 (PLAYING, PAUSED, TRAVELING)
- `setTimelineCursor(current, total)` - line 228 (displays "Timeline: X / Y")
- Integration in main.ts - lines 403-448 (already subscribing to state changes)

**No changes needed** - this functionality is complete from previous deliverables.

---

### Technical Specifications

#### TimelineBar Layout

```
┌─────────────────────────────────────────────────────┐
│  Black padding (8px top)                             │
│  ┌───────────────────────────────────────────────┐  │
│  │ Green bar (24px height)                      │  │
│  │       │                                       │  │
│  │   ← position marker (2px width)              │  │
│  │                                               │  │
│  └───────────────────────────────────────────────┘  │
│  Black padding (8px bottom)                          │
└─────────────────────────────────────────────────────┘
         Positioned 50px from bottom of screen
```

#### Position Calculation

```
markerX = (currentStep / totalSteps) * barWidth
```

- Handle edge cases: `totalSteps = 0` → marker at position 0
- Clamp position to bar bounds

#### Visibility Control

- Only visible in host mode
- Can be toggled via `setVisible()` method for future features
- Initially visible by default

---

### Testing Checklist

- [ ] TimelineBar renders correctly with green bar and black padding
- [ ] Position marker updates when timeline position changes
- [ ] Marker position is accurate (0% = left, 100% = right)
- [ ] TimelineBar responds to window resize
- [ ] TimelineBar only appears in host mode, not client mode
- [ ] TimelineBar sits 50px from bottom of screen
- [ ] DebugOverlay shows correct playback state (PLAYING/PAUSED/TRAVELING)
- [ ] DebugOverlay shows correct timeline cursor ("Timeline: X / Y")
- [ ] No memory leaks on disposal
- [ ] TimelineBar doesn't interfere with other UI elements

---

### Files to Create/Modify

**New Files**:

1. `packages/outside-client/src/ui/timelineBar.ts` - TimelineBar component

**Modified Files**: 2. `packages/outside-client/src/main.ts` - Integrate TimelineBar 3. `packages/outside-client/src/timeline/manager.ts` - Enhance position change notifications (optional but recommended)

**No Changes Needed**:

- `packages/outside-client/src/debug/overlay.ts` - Already complete

---

### Potential Enhancements (Out of Scope)

- Interactive scrubbing (clicking/dragging on timeline)
- Hover tooltips showing exact step numbers
- Visual indicators for special events (LevelStart, etc.)
- Animation when marker position changes
- Configurable colors/sizes

---

### Dependencies

- ✅ Timeline Engine Core (completed)
- ✅ Playback Controls & Game Loop Integration (completed)
- ✅ DebugOverlay (already extended)
- ✅ TimelineManager (already has state management)
- PIXI.js (already in use)

---

**Ready to implement?**
