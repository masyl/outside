services:
  game-server:
    build:
      context: .
      dockerfile: outside-server/Dockerfile
    container_name: game-server-dev
    restart: unless-stopped
    networks:
      - traefik-proxy
    environment:
      - NODE_ENV=development
      - PORT=3000
      - WS_PORT=3001
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.game-server-dev.rule=Host(`api.outside.local`)'
      - 'traefik.http.routers.game-server-dev.entrypoints=https'
      - 'traefik.http.routers.game-server-dev.tls=true'
      - 'traefik.http.routers.game-server-dev.tls.certresolver=local'
      - 'traefik.http.services.game-server-dev.loadbalancer.server.port=3000'
      - 'traefik.http.routers.game-server-ws.rule=Host(`ws.outside.local`)'
      - 'traefik.http.routers.game-server-ws.entrypoints=https'
      - 'traefik.http.routers.game-server-ws.tls=true'
      - 'traefik.http.routers.game-server-ws.tls.certresolver=local'
      - 'traefik.http.services.game-server-ws.loadbalancer.server.port=3001'

  game-client:
    build:
      context: .
      dockerfile: outside-client/Dockerfile
    container_name: game-client-dev
    restart: unless-stopped
    networks:
      - traefik-proxy
    environment:
      - NODE_ENV=development
      - VITE_API_URL=https://api.outside.local
      - VITE_WS_URL=wss://api.outside.local
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.game-client-dev.rule=Host(`outside.local`)'
      - 'traefik.http.routers.game-client-dev.entrypoints=https'
      - 'traefik.http.routers.game-client-dev.tls=true'
      - 'traefik.http.routers.game-client-dev.tls.certresolver=local'
      - 'traefik.http.services.game-client-dev.loadbalancer.server.port=5174'

  storybook:
    build:
      context: .
      dockerfile: outside-storybook/Dockerfile
    container_name: storybook-dev
    restart: unless-stopped
    networks:
      - traefik-proxy
    environment:
      - NODE_ENV=development
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.storybook-dev.rule=Host(`storybook.outside.local`)'
      - 'traefik.http.routers.storybook-dev.entrypoints=https'
      - 'traefik.http.routers.storybook-dev.tls=true'
      - 'traefik.http.routers.storybook-dev.tls.certresolver=local'
      - 'traefik.http.services.storybook-dev.loadbalancer.server.port=6007'

networks:
  traefik-proxy:
    external: true
