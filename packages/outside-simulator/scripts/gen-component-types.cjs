/**
 * Codegen: scans src/components/*.ts (excluding index and this generated file)
 * and writes components.generated.ts with SimulatorComponents interface.
 * Run before build so types are up to date. No manual list of component names.
 */

const fs = require('fs');
const path = require('path');

const COMPONENTS_DIR = path.join(__dirname, '../src/components');
const OUT_FILE = path.join(COMPONENTS_DIR, 'components.generated.ts');
const EXCLUDE = new Set(['index', 'components.generated']);

const files = fs
  .readdirSync(COMPONENTS_DIR)
  .filter(
    (f) =>
      f.endsWith('.ts') &&
      !EXCLUDE.has(path.basename(f, '.ts'))
  )
  .sort();

const names = files.map((f) => path.basename(f, '.ts'));

const lines = [
  '// Generated by scripts/gen-component-types.cjs â€” do not edit.',
  '',
  ...names.map((name) => `import ${name} from './${name}';`),
  '',
  'export interface SimulatorComponents {',
  ...names.map((name) => `  ${name}: typeof ${name};`),
  '}',
  '',
  'export { ' + names.join(', ') + ' };',
  '',
];

fs.writeFileSync(OUT_FILE, lines.join('\n'), 'utf8');
console.log('Generated', OUT_FILE, 'with', names.length, 'components:', names.join(', '));
