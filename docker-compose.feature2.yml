services:
  game-server:
    build:
      context: .
      dockerfile: packages/outside-server/Dockerfile
    container_name: game-server-feature2
    restart: unless-stopped
    networks:
      - traefik-proxy
    environment:
      - NODE_ENV=development
      - PORT=3000
      - WS_PORT=3001
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.game-server-feature2.rule=Host(`api.feature2.outside.local`)'
      - 'traefik.http.routers.game-server-feature2.entrypoints=https'
      - 'traefik.http.routers.game-server-feature2.tls=true'
      - 'traefik.http.routers.game-server-feature2.tls.certresolver=local'
      - 'traefik.http.services.game-server-feature2.loadbalancer.server.port=3000'
      - 'traefik.http.routers.game-server-ws-feature2.rule=Host(`ws.feature2.outside.local`)'
      - 'traefik.http.routers.game-server-ws-feature2.entrypoints=https'
      - 'traefik.http.routers.game-server-ws-feature2.tls=true'
      - 'traefik.http.routers.game-server-ws-feature2.tls.certresolver=local'
      - 'traefik.http.services.game-server-ws-feature2.loadbalancer.server.port=3001'

  game-client:
    build:
      context: .
      dockerfile: packages/outside-client/Dockerfile
    container_name: game-client-feature2
    restart: unless-stopped
    networks:
      - traefik-proxy
    environment:
      - NODE_ENV=development
      - VITE_API_URL=https://api.feature2.outside.local
      - VITE_WS_URL=wss://api.feature2.outside.local
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.game-client-feature2.rule=Host(`feature2.outside.local`)'
      - 'traefik.http.routers.game-client-feature2.entrypoints=https'
      - 'traefik.http.routers.game-client-feature2.tls=true'
      - 'traefik.http.routers.game-client-feature2.tls.certresolver=local'
      - 'traefik.http.services.game-client-feature2.loadbalancer.server.port=5174'

  storybook:
    build:
      context: .
      dockerfile: packages/outside-storybook/Dockerfile
    container_name: storybook-feature2
    restart: unless-stopped
    networks:
      - traefik-proxy
    environment:
      - NODE_ENV=development
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.storybook-feature2.rule=Host(`storybook.feature2.outside.local`)'
      - 'traefik.http.routers.storybook-feature2.entrypoints=https'
      - 'traefik.http.routers.storybook-feature2.tls=true'
      - 'traefik.http.routers.storybook-feature2.tls.certresolver=local'
      - 'traefik.http.services.storybook-feature2.loadbalancer.server.port=6007'

networks:
  traefik-proxy:
    external: true
